<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Logger Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.0/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .download-btn {
            margin: 0.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
        }
        
        .refresh-indicator {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .filter-controls {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-tachometer-alt"></i> Internet Speed Logger Dashboard</h1>
                    <p class="mb-0">Real-time monitoring of your internet connection speed</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="{{ url_for('admin_login') }}" class="btn btn-outline-light me-2">
                        <i class="fas fa-cog"></i> Admin
                    </a>
                    <button id="refreshBtn" class="btn btn-light btn-lg">
                        <i id="refreshIcon" class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card stat-card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-download stat-icon text-primary"></i>
                        <h5 class="card-title">
                            Hourly Avg Download
                            <i class="fas fa-info-circle ms-1" 
                               title="Average calculated from hourly readings only (±25min tolerance)" 
                               style="font-size: 0.8em; color: #6c757d;"></i>
                        </h5>
                        <h3 id="avgDownload" class="text-primary">--</h3>
                        <small class="text-muted">Mbps</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stat-card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-upload stat-icon text-success"></i>
                        <h5 class="card-title">
                            Hourly Avg Upload
                            <i class="fas fa-info-circle ms-1" 
                               title="Average calculated from hourly readings only (±25min tolerance)" 
                               style="font-size: 0.8em; color: #6c757d;"></i>
                        </h5>
                        <h3 id="avgUpload" class="text-success">--</h3>
                        <small class="text-muted">Mbps</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stat-card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-stopwatch stat-icon text-warning"></i>
                        <h5 class="card-title">
                            Hourly Avg Ping
                            <i class="fas fa-info-circle ms-1" 
                               title="Average calculated from hourly readings only (±25min tolerance)" 
                               style="font-size: 0.8em; color: #6c757d;"></i>
                        </h5>
                        <h3 id="avgPing" class="text-warning">--</h3>
                        <small class="text-muted">ms</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stat-card text-center h-100">
                    <div class="card-body">
                        <i class="fas fa-chart-line stat-icon text-info"></i>
                        <h5 class="card-title">Total Tests</h5>
                        <h3 id="totalTests" class="text-info">{{ total_tests }}</h3>
                        <small class="text-muted">recorded</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <h5><i class="fas fa-filter"></i> Time Period</h5>
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check" name="timeFilter" id="filter24h" value="1">
                        <label class="btn btn-outline-primary" for="filter24h">24 Hours</label>
                        
                        <input type="radio" class="btn-check" name="timeFilter" id="filter7d" value="7" checked>
                        <label class="btn btn-outline-primary" for="filter7d">7 Days</label>
                        
                        <input type="radio" class="btn-check" name="timeFilter" id="filter30d" value="30">
                        <label class="btn btn-outline-primary" for="filter30d">30 Days</label>
                        
                        <input type="radio" class="btn-check" name="timeFilter" id="filterAll" value="all">
                        <label class="btn btn-outline-primary" for="filterAll">All Time</label>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <h5><i class="fas fa-play"></i> Manual Test</h5>
                    <button id="manualTestBtn" class="btn btn-success btn-lg" style="min-width: 200px;">
                        <i class="fas fa-rocket"></i> <span id="manualTestText">Run Speed Test</span>
                    </button>
                    <div id="manualTestStatus" class="mt-2"></div>
                </div>
                <div class="col-md-4 text-end">
                    <h5><i class="fas fa-download"></i> Download Data</h5>
                    <button id="downloadCsv" class="btn btn-success download-btn">
                        <i class="fas fa-file-csv"></i> Download CSV
                    </button>
                    <button id="downloadFilteredCsv" class="btn btn-outline-success download-btn">
                        <i class="fas fa-filter"></i> Download Filtered
                    </button>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <h4><i class="fas fa-chart-line"></i> Internet Speed & Ping Over Time</h4>
                    <canvas id="speedChart" height="100"></canvas>
                </div>
            </div>
        </div>

        <!-- Subscription Package Performance -->
        <div class="row">
            <div class="col-md-8">
                <div class="chart-container">
                    <h4><i class="fas fa-box"></i> Package Performance: <span id="packageName">Loading...</span></h4>
                    <div id="packagePerformance" class="row">
                        <!-- Package performance will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="chart-container">
                    <h4><i class="fas fa-chart-pie"></i> Speed Distribution</h4>
                    <canvas id="distributionChart" height="150"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Test Attempts -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5>
                            <i class="fas fa-list-alt"></i> Recent Test Attempts
                            <span id="serviceStatus" class="badge bg-success ms-2">Service Running</span>
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th width="25%">Time</th>
                                        <th width="15%">Status</th>
                                        <th width="60%">Details</th>
                                    </tr>
                                </thead>
                                <tbody id="recentAttemptsTable">
                                    <tr>
                                        <td colspan="3" class="text-center text-muted">Loading recent attempts...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> 
                            Shows the last 5 test attempts from service logs. Auto-refreshes every 30 seconds.
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Info -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5><i class="fas fa-info-circle"></i> System Status</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Last Test:</strong> <span id="lastTest">--</span></p>
                                <p><strong>First Test:</strong> <span id="firstTest">--</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Data File:</strong> <span id="dataFile">internet_speed_log.csv</span></p>
                                <p><strong>Auto Refresh:</strong> <span class="badge bg-success">Every 30 seconds</span></p>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="alert alert-info" style="margin-bottom: 0;">
                                    <h6><i class="fas fa-calculator"></i> Honest Hourly Averaging</h6>
                                    <p class="mb-2">
                                        <strong>Total Tests:</strong> <span id="totalTestsInfo">--</span> | 
                                        <strong>Hourly Tests Used:</strong> <span id="hourlyTestsInfo">--</span> | 
                                        <strong>Excluded:</strong> <span id="excludedTestsInfo">--</span>
                                    </p>
                                    <small class="text-muted">
                                        Averages calculated using only readings that are approximately 60 minutes apart (±25min tolerance). 
                                        This excludes irregular readings from service restarts, manual tests, or different intervals, 
                                        providing more accurate long-term performance averages.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5 py-4 bg-dark text-light text-center">
        <div class="container">
            <p>&copy; 2025 Internet Speed Logger Dashboard. Last updated: <span id="lastUpdate">--</span></p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let speedChart, distributionChart;
        let currentFilter = '7';
        let manualTestCooldown = 0;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            loadData();
            setupEventListeners();
            
            // Auto refresh every 30 seconds
            setInterval(loadData, 30000);
        });
        
        function initCharts() {
            // Speed over time chart (with ping on secondary y-axis)
            const speedCtx = document.getElementById('speedChart').getContext('2d');
            speedChart = new Chart(speedCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Download Speed (Mbps)',
                        data: [],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'Upload Speed (Mbps)',
                        data: [],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'Ping (ms)',
                        data: [],
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                displayFormats: {
                                    hour: 'MMM dd HH:mm',
                                    day: 'MMM dd'
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Speed (Mbps)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ping (ms)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
            
            // Distribution chart
            const distCtx = document.getElementById('distributionChart').getContext('2d');
            distributionChart = new Chart(distCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Above Target', 'Near Target (75-100%)', 'Below Target (50-75%)', 'Poor (<50%)'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: ['#28a745', '#17a2b8', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function setupEventListeners() {
            // Time filter change
            document.querySelectorAll('input[name="timeFilter"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentFilter = this.value;
                    loadData();
                });
            });
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                const icon = document.getElementById('refreshIcon');
                icon.classList.add('refresh-indicator');
                loadData().finally(() => {
                    icon.classList.remove('refresh-indicator');
                });
            });
            
            // Manual test button
            document.getElementById('manualTestBtn').addEventListener('click', runManualTest);
            
            // Download buttons
            document.getElementById('downloadCsv').addEventListener('click', function() {
                window.open('/download/csv', '_blank');
            });
            
            document.getElementById('downloadFilteredCsv').addEventListener('click', function() {
                const params = currentFilter === 'all' ? '' : `?days=${currentFilter}`;
                window.open(`/download/filtered-csv${params}`, '_blank');
            });
        }
        
        async function loadData() {
            try {
                const params = currentFilter === 'all' ? '' : `?days=${currentFilter}`;
                const chartResponse = await fetch(`/api/chart-data${params}`);
                const chartData = await chartResponse.json();
                
                const statsResponse = await fetch(`/api/data${params}`);
                const statsData = await statsResponse.json();
                
                // Load recent attempts
                const attemptsResponse = await fetch('/api/recent-attempts');
                const attemptsData = await attemptsResponse.json();
                
                // Update stats first to set window.currentConfig before updating charts
                updateStatsFromData(statsData);
                updateCharts(chartData);
                updateRecentAttempts(attemptsData);
                updateLastUpdate();
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function updateStatsFromData(result) {
            if (result.stats) {
                document.getElementById('avgDownload').textContent = result.stats.download?.avg || '--';
                document.getElementById('avgUpload').textContent = result.stats.upload?.avg || '--';
                document.getElementById('avgPing').textContent = result.stats.ping?.avg || '--';
                document.getElementById('totalTests').textContent = result.stats.total_tests || 0;
                document.getElementById('firstTest').textContent = result.stats.first_test || '--';
                document.getElementById('lastTest').textContent = result.stats.last_test || '--';
                
                // Update honest averaging info
                document.getElementById('totalTestsInfo').textContent = result.stats.total_tests || '--';
                document.getElementById('hourlyTestsInfo').textContent = result.stats.hourly_tests || '--';
                document.getElementById('excludedTestsInfo').textContent = result.stats.excluded_readings || '--';
            }
            
            // Update package performance
            if (result.package_performance) {
                updatePackagePerformance(result.package_performance);
            }
            
            // Store config for distribution chart updates - this is critical for the distribution chart
            window.currentConfig = result.config;
            console.log('Config loaded for distribution chart:', window.currentConfig?.package?.download || 'No package config');
            
            // Update manual test button
            updateManualTestButton();
        }
        
        function updateCharts(data) {
            // Update speed chart (including ping)
            speedChart.data.labels = data.labels;
            speedChart.data.datasets[0].data = data.download_speeds;
            speedChart.data.datasets[1].data = data.upload_speeds;
            speedChart.data.datasets[2].data = data.ping_times;
            speedChart.update();
            
            // Update distribution chart based on subscription package
            console.log('Updating distribution chart with', data.download_speeds?.length || 0, 'speeds');
            updateDistributionChart(data.download_speeds);
        }
        
        function updateDistributionChart(downloadSpeeds) {
            if (!window.currentConfig || !window.currentConfig.package) {
                console.warn('Distribution chart: Config not loaded yet, skipping update');
                return;
            }
            
            if (!downloadSpeeds || downloadSpeeds.length === 0) {
                console.warn('Distribution chart: No download speeds data available');
                return;
            }
            
            const target = window.currentConfig.package.download;
            if (!target || target <= 0) {
                console.warn('Distribution chart: Invalid target speed in config');
                return;
            }
            
            const aboveTarget = downloadSpeeds.filter(speed => speed >= target).length;
            const nearTarget = downloadSpeeds.filter(speed => speed >= target * 0.75 && speed < target).length;
            const belowTarget = downloadSpeeds.filter(speed => speed >= target * 0.5 && speed < target * 0.75).length;
            const poor = downloadSpeeds.filter(speed => speed < target * 0.5).length;
            
            // Update labels with actual target values
            distributionChart.data.labels = [
                `Above Target (≥${target} Mbps)`,
                `Near Target (${(target * 0.75).toFixed(1)}-${target} Mbps)`,
                `Below Target (${(target * 0.5).toFixed(1)}-${(target * 0.75).toFixed(1)} Mbps)`,
                `Poor (<${(target * 0.5).toFixed(1)} Mbps)`
            ];
            
            distributionChart.data.datasets[0].data = [aboveTarget, nearTarget, belowTarget, poor];
            distributionChart.update();
        }
        
        function updateRecentAttempts(data) {
            const table = document.getElementById('recentAttemptsTable');
            const serviceStatus = document.getElementById('serviceStatus');
            
            // Update service status badge
            if (data.service_running) {
                serviceStatus.textContent = 'Service Running';
                serviceStatus.className = 'badge bg-success ms-2';
            } else {
                serviceStatus.textContent = 'Service Stopped';
                serviceStatus.className = 'badge bg-danger ms-2';
            }
            
            // Clear existing table content
            table.innerHTML = '';
            
            if (!data.recent_attempts || data.recent_attempts.length === 0) {
                table.innerHTML = '<tr><td colspan="3" class="text-center text-muted">No recent attempts found</td></tr>';
                return;
            }
            
            // Populate table with recent attempts
            data.recent_attempts.forEach(attempt => {
                const row = document.createElement('tr');
                
                // Time column
                const timeCell = document.createElement('td');
                timeCell.innerHTML = `
                    <div>${attempt.timestamp_readable}</div>
                    <small class="text-muted">${attempt.timestamp_relative}</small>
                `;
                
                // Status column
                const statusCell = document.createElement('td');
                let statusBadge = '';
                switch(attempt.status) {
                    case 'success':
                        statusBadge = '<span class="badge bg-success">Success</span>';
                        break;
                    case 'failed':
                        statusBadge = '<span class="badge bg-danger">Failed</span>';
                        break;
                    case 'started':
                        statusBadge = '<span class="badge bg-info">Started</span>';
                        break;
                    case 'warning':
                        statusBadge = '<span class="badge bg-warning">Warning</span>';
                        break;
                    default:
                        statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                }
                statusCell.innerHTML = statusBadge;
                
                // Details column
                const detailsCell = document.createElement('td');
                detailsCell.textContent = attempt.message;
                
                // Add icon based on type
                if (attempt.type === 'error') {
                    detailsCell.innerHTML = '<i class="fas fa-exclamation-triangle text-danger me-1"></i>' + attempt.message;
                } else if (attempt.type === 'success') {
                    detailsCell.innerHTML = '<i class="fas fa-check-circle text-success me-1"></i>' + attempt.message;
                } else if (attempt.type === 'warning') {
                    detailsCell.innerHTML = '<i class="fas fa-exclamation-circle text-warning me-1"></i>' + attempt.message;
                } else {
                    detailsCell.innerHTML = '<i class="fas fa-info-circle text-info me-1"></i>' + attempt.message;
                }
                
                row.appendChild(timeCell);
                row.appendChild(statusCell);
                row.appendChild(detailsCell);
                table.appendChild(row);
            });
        }
        
        async function runManualTest() {
            const btn = document.getElementById('manualTestBtn');
            const btnText = document.getElementById('manualTestText');
            const status = document.getElementById('manualTestStatus');
            
            try {
                // Disable button and show loading
                btn.disabled = true;
                btnText.textContent = 'Running Test...';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-secondary');
                status.innerHTML = '<small class="text-info"><i class="fas fa-spinner fa-spin"></i> Running speed test...</small>';
                
                const response = await fetch('/api/manual-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    status.innerHTML = '<small class="text-success"><i class="fas fa-check"></i> ' + result.message + '</small>';
                    // Refresh data after a short delay to allow test to complete
                    setTimeout(() => {
                        loadData();
                    }, 5000);
                } else {
                    status.innerHTML = '<small class="text-danger"><i class="fas fa-exclamation-triangle"></i> ' + result.message + '</small>';
                }
                
            } catch (error) {
                status.innerHTML = '<small class="text-danger"><i class="fas fa-exclamation-triangle"></i> Error: ' + error.message + '</small>';
            }
            
            // Update button state
            updateManualTestButton();
        }
        
        function updateManualTestButton() {
            const btn = document.getElementById('manualTestBtn');
            const btnText = document.getElementById('manualTestText');
            const status = document.getElementById('manualTestStatus');
            
            // Check manual test status
            fetch('/api/manual-test-status')
                .then(response => response.json())
                .then(data => {
                    if (data.can_test) {
                        btn.disabled = false;
                        btnText.textContent = 'Run Speed Test';
                        btn.classList.remove('btn-secondary');
                        btn.classList.add('btn-success');
                        if (status.innerHTML.includes('Running') || status.innerHTML.includes('completed')) {
                            status.innerHTML = '';
                        }
                    } else {
                        btn.disabled = true;
                        btnText.textContent = `Wait ${data.cooldown_remaining}min`;
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-secondary');
                        if (!status.innerHTML.includes('Running') && !status.innerHTML.includes('Error')) {
                            status.innerHTML = `<small class="text-warning"><i class="fas fa-clock"></i> Next manual test available in ${data.cooldown_remaining} minutes</small>`;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error checking manual test status:', error);
                });
        }
        
        function updatePackagePerformance(packagePerformance) {
            const container = document.getElementById('packagePerformance');
            const packageNameEl = document.getElementById('packageName');
            
            if (!packagePerformance || !packagePerformance.name) {
                container.innerHTML = '<div class="col-12"><p class="text-muted">No package configured</p></div>';
                packageNameEl.textContent = 'Not Configured';
                return;
            }
            
            packageNameEl.textContent = packagePerformance.name;
            
            const successRate = packagePerformance.overall_success_rate;
            let badgeClass = 'bg-danger';
            let statusIcon = 'fa-times-circle';
            let statusText = 'Below Target';
            
            if (successRate >= 90) {
                badgeClass = 'bg-success';
                statusIcon = 'fa-check-circle';
                statusText = 'Excellent';
            } else if (successRate >= 70) {
                badgeClass = 'bg-warning';
                statusIcon = 'fa-exclamation-circle';
                statusText = 'Good';
            }
            
            container.innerHTML = `
                <div class="col-md-4">
                    <div class="card h-100 border-primary">
                        <div class="card-body text-center">
                            <h5 class="card-title text-primary">Overall Performance</h5>
                            <div class="mb-3">
                                <span class="badge ${badgeClass} fs-4">
                                    <i class="fas ${statusIcon}"></i> ${successRate}%
                                </span>
                            </div>
                            <p class="mb-0"><strong>${statusText}</strong></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-info">
                        <div class="card-body text-center">
                            <h6 class="card-title text-info">Download Target</h6>
                            <h4 class="text-info">${packagePerformance.download_target} Mbps</h4>
                            <p class="mb-0">Success Rate: <strong>${packagePerformance.download_success_rate}%</strong></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 border-success">
                        <div class="card-body text-center">
                            <h6 class="card-title text-success">Upload Target</h6>
                            <h4 class="text-success">${packagePerformance.upload_target} Mbps</h4>
                            <p class="mb-0">Success Rate: <strong>${packagePerformance.upload_success_rate}%</strong></p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateLastUpdate() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
        }
    </script>
</body>
</html>